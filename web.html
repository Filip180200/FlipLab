<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlipLab - Stream Viewer</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Logo and site name -->
    <div class="site-header">
        <div class="logo-container">
            <i class="fas fa-sync-alt logo-icon"></i>
            <span class="site-name">FlipLab</span>
            <div class="timer-container">
                <span class="countdown" id="countdown">15:00</span>
            </div>
        </div>
    </div>

    <!-- Zawartość strony (wideo i komentarze) -->
    <div id="mainContent">
        <div class="content-wrapper">
            <div class="channels-sidebar">
                <h3 class="channels-header">Recommended</h3>
                <div class="channel-list">
                    <div class="channel">
                        <img class="channel-avatar" src="https://static-cdn.jtvnw.net/jtv_user_pictures/5a72c3d9-424a-40a6-bf23-73370cd85578-profile_image-70x70.png" alt="Lofi Girl">
                        <div class="channel-details">
                            <div class="channel-name">Lofi Girl</div>
                            <div class="channel-game">Just Chatting</div>
                        </div>
                        <div class="viewer-count">12.8K</div>
                    </div>
                    <div class="channel">
                        <img class="channel-avatar" src="https://static-cdn.jtvnw.net/jtv_user_pictures/7ed5e0c6-0191-4eef-8328-4af6e4ea5318-profile_image-70x70.png" alt="pokimane">
                        <div class="channel-details">
                            <div class="channel-name">pokimane</div>
                            <div class="channel-game">Just Chatting</div>
                        </div>
                        <div class="viewer-count">25.4K</div>
                    </div>
                    <div class="channel">
                        <img class="channel-avatar" src="https://static-cdn.jtvnw.net/jtv_user_pictures/f040f0d4-8b30-4215-bd9e-06a2c3977a8c-profile_image-70x70.png" alt="Faker">
                        <div class="channel-details">
                            <div class="channel-name">Faker</div>
                            <div class="channel-game">League of Legends</div>
                        </div>
                        <div class="viewer-count">89.2K</div>
                    </div>
                    <div class="channel">
                        <img class="channel-avatar" src="https://static-cdn.jtvnw.net/jtv_user_pictures/32805a78-d927-48bd-8089-bf5efed53ea4-profile_image-70x70.png" alt="Dream">
                        <div class="channel-details">
                            <div class="channel-name">Dream</div>
                            <div class="channel-game">Minecraft</div>
                        </div>
                        <div class="viewer-count">45.6K</div>
                    </div>
                </div>
            </div>
            <div class="main-content">
                <div class="video-section">
                    <div class="video-container">
                        <div id="player"></div>
                        <div class="stream-info">
                            <div class="stream-header">
                                <div class="stream-header-left">
                                    <img src="https://static-cdn.jtvnw.net/jtv_user_pictures/cd921fcd-53fc-4b1d-be23-0787bc36b756-profile_image-70x70.png" alt="Channel Avatar" class="stream-avatar">
                                    <div class="stream-details">
                                        <h2 class="stream-title">Awesome Gaming Stream</h2>
                                        <div class="channel-info">
                                            <div class="channel-name">Channel Name</div>
                                        </div>
                                        <div class="category-section">
                                            <a href="#" class="channel-category">Just Chatting</a>
                                            <span class="tag">English</span>
                                            <span class="tag">Entertainment</span>
                                        </div>
                                    </div>
                                    <div class="stream-buttons">
                                        <div class="buttons-row">
                                            <button class="follow-btn"><i class="fas fa-heart"></i> Follow</button>
                                            <button class="subscribe-btn"><i class="far fa-star"></i> <span>Subscribe</span></button>
                                        </div>
                                        <div class="stream-viewers">
                                            <i class="far fa-user"></i>
                                            <span class="viewer-label">Viewers</span>
                                            <span class="viewer-number">1,200</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="chat-section">
                    <div class="chat-messages" id="chatMessages">
                        <div class="chat-message">
                            <img src="https://static-cdn.jtvnw.net/user-default-pictures-uv/13e5fa74-defa-11e9-809c-784f43822e80-profile_image-70x70.png" class="chat-avatar" alt="User avatar">
                            <div class="message-content-wrapper">
                                <div class="message-header">
                                    <span class="username">User123</span>
                                </div>
                                <div class="message-content">Hello everyone!</div>
                            </div>
                        </div>
                    </div>
                    <form id="commentForm">
                        <input type="text" id="comment" placeholder="Napisz komentarz..." required>
                        <button type="submit">Wyślij</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <script src="https://www.youtube.com/iframe_api"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
    <script src="script.js"></script>
    <!-- Report Overlay -->
    <div class="report-overlay"></div>
    
    <!-- Report Modal -->
    <div id="reportModal" class="report-preview">
        <div class="user-info">
            <img src="" class="chat-avatar" alt="User avatar">
            <div class="user-details">
                <div class="user-header">
                <span class="preview-username" id="reportUsername"></span>
                <button class="close-preview"><i class="fas fa-times"></i></button>
                </div>
            </div>
        </div>
        <div class="recent-messages">
            <h3>Recent Comments</h3>
            <div id="reportUserComments"></div>
        </div>
        <div class="report-actions">
            <button class="report-submit">Report User</button>
        </div>
    </div>
    <script>
        let timeLeft = 3600; // Default 1 hour in seconds
        let timerInterval;
        const username = localStorage.getItem('username');

        // Function to format time as MM:SS
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
        }

        // Function to update timer display and sync with server
        async function updateTimer() {
            if (timeLeft > 0) {
                timeLeft--;
                document.getElementById('countdown').textContent = formatTime(timeLeft);
                
                // Sync with server every 30 seconds
                if (timeLeft % 30 === 0) {
                    try {
                        await fetch('/api/update-time', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                username,
                                timeLeft
                            })
                        });
                    } catch (error) {
                        console.error('Error syncing time:', error);
                    }
                }
            } else {
                clearInterval(timerInterval);
                alert('Your time has expired!');
                window.location.href = '/';
            }
        }

        // Load initial time from server
        async function loadTimeLeft() {
            try {
                const response = await fetch(`/api/time-left/${username}`);
                const data = await response.json();
                timeLeft = data.timeLeft;
                document.getElementById('countdown').textContent = formatTime(timeLeft);
                
                // Start timer
                timerInterval = setInterval(updateTimer, 1000);
            } catch (error) {
                console.error('Error loading time:', error);
            }
        }

        function startCountdown() {
            loadTimeLeft();
        }

        // Initialize timer when page loads
        document.addEventListener('DOMContentLoaded', startCountdown);
    </script>
</body>
</html>
